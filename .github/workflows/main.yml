name: Crear rama hotfix
on:
  workflow_dispatch:

jobs:
  crear-rama:
    runs-on: ubuntu-latest

    steps:
      - name: Imprimir mensaje de inicio
        run: echo "Iniciando workflow para crear rama hotfix"

      - name: Checkout del código
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0  # Trae todo el historial para poder crear ramas

      - name: Configurar usuario de Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      # 4️⃣ Autenticarse con el token del repositorio
      # (Reemplaza por tu token personalizado si lo usas con act)
      - name: Autenticar con token de GitHub
        run: |
          git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}

      # 5️⃣ Actualizar main y crear la nueva rama
      - name: Crear rama hotfix
        run: |
          git checkout main
          git pull origin main
          git checkout -b hotfix/1.0.1

      # 6️⃣ Subir la nueva rama al remoto
      - name: Subir rama al remoto
        run: git push origin hotfix/1.0.1

      # 7️⃣ Confirmar finalización
      - name: Mensaje de éxito
        run: echo "✅ Rama 'hotfix/1.0.1' creada y subida correctamente."
